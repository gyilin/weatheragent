name: æ¯æ—¥å¤©æ°”æé†’

on:
  schedule:
    - cron: '0 12 * * *'  # æ¯å¤© 8 AM ç¾Žä¸œæ—¶é—´ï¼ˆUTC+0 æ˜¯ 12 PMï¼‰
  workflow_dispatch:

jobs:
  weather:
    runs-on: ubuntu-latest
    steps:
      - name: è®¾ç½® Python çŽ¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: å®‰è£…ä¾èµ–
        run: pip install requests

      - name: èŽ·å–å¤©æ°”å¹¶æŽ¨é€
        env:
          API_KEY: ${{ secrets.OWM_KEY }}
          CITY: ${{ secrets.CITY }}
          SENDKEY: ${{ secrets.SENDKEY }}
        run: |
          echo "import requests, datetime

API_KEY = '${{ secrets.OWM_KEY }}'
CITY = '${{ secrets.CITY }}'
SENDKEY = '${{ secrets.SENDKEY }}'

def get_weather():
    url = f'https://api.openweathermap.org/data/2.5/weather?q={CITY}&appid={API_KEY}&units=metric&lang=zh_cn'
    resp = requests.get(url)
    data = resp.json()
    if resp.status_code != 200 or 'weather' not in data:
        return 'âŒ æ— æ³•èŽ·å–å¤©æ°”ä¿¡æ¯'
    weather_desc = data['weather'][0]['description']
    temp = data['main']['temp']
    feels_like = data['main']['feels_like']
    wind_speed = data['wind']['speed']
    humidity = data['main']['humidity']
    date = datetime.datetime.now().strftime('%Y-%m-%d (%A)')
    msg = (
        f'ðŸ“ åŸŽå¸‚ï¼š{CITY}\\n'
        f'ðŸ“… æ—¥æœŸï¼š{date}\\n'
        f'ðŸŒ¦ï¸ å¤©æ°”ï¼š{weather_desc}\\n'
        f'ðŸŒ¡ï¸ æ°”æ¸©ï¼š{temp}â„ƒï¼ˆä½“æ„Ÿ {feels_like}â„ƒï¼‰\\n'
        f'ðŸ’§ æ¹¿åº¦ï¼š{humidity}%\\n'
        f'ðŸ’¨ é£Žé€Ÿï¼š{wind_speed} m/s\\n'
        f'ðŸ§¥ æç¤ºï¼šæ ¹æ®å¤©æ°”æƒ…å†µåˆç†ç©¿è¡£å“¦ï½ž'
    )
    return msg

def send_wechat(msg):
    url = f'https://sctapi.ftqq.com/{SENDKEY}.send'
    data = {'title': 'ä»Šæ—¥å¤©æ°”æé†’ â˜€ï¸', 'desp': msg}
    requests.post(url, data=data)

send_wechat(get_weather())
" > weather.py
          python weather.py
